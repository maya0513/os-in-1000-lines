# ミニOS ユーザーガイド

このドキュメントでは、RISC-V上で動作するミニOSの機能と使用方法について説明します。

## OSの起動

OSを起動するには、プロジェクトのルートディレクトリで以下のコマンドを実行してください：

```bash
./run.sh
```

これにより、OSがQEMU上で起動し、シェルプロンプトが表示されます。

## シェルの使用方法

OSが起動すると、対話型シェルが開始されます。プロンプト `>` が表示され、以下のコマンドを実行できます。

### 利用可能なコマンド

#### `hello`
```
> hello
Hello world from shell!
```
シンプルなメッセージを表示します。OSの基本動作を確認できます。

#### `readfile`
```
> readfile
aaa
```
ディスクから `hello.txt` ファイルの内容を読み取り、表示します。VirtIO ブロックデバイスとTARファイルシステムの動作を確認できます。

#### `writefile`
```
> writefile
```
`hello.txt` ファイルに "Hello from shell!" というメッセージを書き込みます（注：現在の実装では、書き込み結果の表示はありません）。

#### `exit`
```
> exit
```
シェルを終了し、プロセスを停止します。

### コマンド入力の制限

- コマンドライン長は最大127文字です
- 未知のコマンドを入力すると、エラーメッセージが表示されます
- 入力した文字は即座にエコーバックされます

## システムの機能

### マルチプロセシング
- 最大8つのプロセスを同時実行可能
- 協調的マルチタスキング（プロセスは明示的に`yield()`を呼び出して制御を譲る）
- ラウンドロビンスケジューリング

### メモリ管理
- SV32仮想メモリ（32ビット仮想アドレス空間）
- 4KBページサイズ
- カーネル空間（0x80200000〜）とユーザー空間（0x1000000〜）の分離
- プロセスごとに64KBのスタック領域

### ファイルシステム
- TAR形式のシンプルなファイルシステム
- 読み取り専用操作をサポート
- `disk/` ディレクトリ内のファイルがTARアーカイブとして組み込まれる

### システムコール
以下のシステムコールが利用可能です：
- `putchar(char)`: 文字の出力
- `getchar()`: 文字の入力（ブロッキング）
- `exit()`: プロセスの終了

### ハードウェア機能
- RISC-V 32ビットアーキテクチャ
- VirtIOブロックデバイスによるディスクアクセス
- SBI（Supervisor Binary Interface）による低レベルI/O

## 制限事項

### 現在サポートしていない機能
- ダイナミックメモリ割り当て解放（ガベージコレクション）
- ネットワーク機能
- 複雑なファイル操作（作成、削除、移動など）
- パイプやリダイレクション
- バックグラウンドプロセス実行

### メモリ制限
- カーネルヒープ：64MB
- プロセススタック：各64KB
- ページアロケータは解放をサポートせず（バンプアロケータ）

## 終了方法

OSから抜けるには：
1. シェルで `exit` コマンドを実行
2. QEMUコンソールで `Ctrl+A` → `X` を押す
3. ターミナルで `Ctrl+C` を押す

## トラブルシューティング

### OSが起動しない場合
- QEMUとRISC-V toolchainが正しくインストールされているか確認
- `firmware/opensbi-riscv32-generic-fw_dynamic.bin` ファイルが存在するか確認

### コマンドが動作しない場合
- 大文字小文字を正確に入力しているか確認
- サポートされているコマンドのみ使用しているか確認

このミニOSは教育目的で作られており、実際のプロダクション環境での使用は想定されていません。RISC-Vアーキテクチャとオペレーティングシステムの基本概念を学習するためのものです。